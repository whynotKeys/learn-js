<!DOCTYPE html>
<html lang="ko-KR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Todo List App</title>
  </head>
  <body>
    <div id="todo">
      <header>
        <h1>Todo List - ëª©ë¡ ì¡°íšŒ ğŸ™‚</h1>
      </header>
      <div id="main">
        <div id="container">
          <ul>
            <li>
              <h2>ì‡¼í•‘ ëª©ë¡</h2>
              <!-- ìƒˆë¡œìš´ í• ì¼ ì…ë ¥ í¼ -->
              <div class="todoinput">
                <input type="text" autofocus onkeyup="handleKeyup(event)" />
                <button type="button" onclick="handleAdd()">ì¶”ê°€</button>
              </div>
              <!-- í• ì¼ ëª©ë¡ì´ í‘œì‹œë˜ëŠ” ì˜ì—­ -->
              <ul class="todolist">
                <!-- <li data-no="1">
                  <span tabindex="0">1</span>
                  <span><s>ìƒ˜í”Œ1</s></span>
                  <button type="button">ì‚­ì œ</button>
                </li>
                <li data-no="2">
                  <span tabindex="0">2</span>
                  <span>ìƒ˜í”Œ2</span>
                  <button type="button">ì‚­ì œ</button>
                </li>
                <li data-no="3">
                  <span tabindex="0">3</span>
                  <span>ìƒ˜í”Œ3</span>
                  <button type="button">ì‚­ì œ</button>
                </li> -->
              </ul>
            </li>
          </ul>
        </div>
      </div>
      <footer>
        <p>ë©‹ìŸì´ ì‚¬ìì²˜ëŸ¼ FrontEnd BootCamp</p>
      </footer>
    </div>

    <script>
      /**
       * Todo ì•„ì´í…œ í•˜ë‚˜ë¥¼ í‘œí˜„í•˜ëŠ” DOM ìš”ì†Œë¥¼ ìƒì„±í•˜ëŠ” í•¨ìˆ˜
       * @param {Object} item - Todo ì•„ì´í…œ ê°ì²´ {no: number, title: string, done: boolean}
       * @returns {HTMLElement} ìƒì„±ëœ Todo ì•„ì´í…œì˜ DOM ìš”ì†Œ
       */
      function getTodoItemElem(item) {
        // item ->{ no: 3, title: 'ë¼ë©´', done: true } // Todo ê°ì²´
        /* DOM ê°ì²´
        <li>
          <span>1</span>
          <span><s>ìƒ˜í”Œ1</s></span>
          <button type="button">ì‚­ì œ</button>
        </li>
        */
        // <li> ìƒì„±
        const liElem = document.createElement("li");
        // <span> ìƒì„±
        const noElem = document.createElement("span");
        // <span> ìƒì„±
        const titleElem = document.createElement("span");
        // <button> ìƒì„±
        const deleteElem = document.createElement("button");

        // 3
        const noTxt = document.createTextNode(item.no);
        // ìƒ˜í”Œ3
        const titleTxt = document.createTextNode(item.title);
        // ì‚­ì œ
        const deleteTxt = document.createTextNode("ì‚­ì œ");

        // <span>1</span> ì¡°ë¦½
        noElem.appendChild(noTxt);
        // <span><s>ìƒ˜í”Œ1</s></span> ì¡°ë¦½
        titleElem.appendChild(titleTxt);
        // <button type="button">ì‚­ì œ</button> ì¡°ë¦½
        deleteElem.setAttribute("type", "button"); // ì†ì„± ë”í•˜ëŠ” ë©”ì†Œë“œ
        titleElem.setAttribute("tabindex", 0); // ì™„ë£Œ/ë¯¸ì™„ë£Œ ì²˜ë¦¬ë¥¼ ìœ„í•œ íƒ­ í¬ì»¤ì‹± *****ì ‘ê·¼ì„±

        deleteElem.appendChild(deleteTxt);

        // <li>ì˜ ìì‹ìœ¼ë¡œ ëª¨ë‘ ì¶”ê°€
        liElem.appendChild(noElem);
        liElem.appendChild(titleElem);
        liElem.appendChild(deleteElem);

        // CUSTOM ì†ì„±
        //<li data-no="3">
        // elem.dataset.no -> 3
        liElem.dataset.no = item.no;

        // <li> -> <li data-no="3" data-done="true">
        // liElem.setAttribute("data-no", item.no);
        // liElem.setAttribute("data-done", "true");
        // ìœ„ 2ì¤„ê³¼ ë™ì¼í•œ íš¨ê³¼
        liElem.dataset.no = item.no;
        liElem.dataset.done = item.done;

        //ì‚­ì œ ë²„íŠ¼ì— í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì¶”ê°€ (ì‚­ì œë°©ë²•1)
        deleteElem.addEventListener("click", function (event) {
          //no.ë¥¼ ì°¾ëŠ” ì²«ë²ˆì§¸ ë°©ë²• (: closestë¡œ ì¡°ìƒ ì°¾ê¸°)
          const btn = event.target; // click eventê°€ ë°œìƒí•œ ìš”ì†Œ (button)
          // closest = btnì˜ ì¡°ìƒ ì¤‘ ì…€ë ‰í„°ì™€ ì¼ì¹˜í•˜ëŠ” ê°€ì¥ ê°€ê¹Œìš´ ì¡°ìƒ
          const liNode = btn.closest("li"); // <li data-no="3">
          // console.log(liNode.dataset.no, "ì‚­ì œ");
          deleteItem(liNode.dataset.no);

          //(ì‚­ì œë°©ë²•2)
          //no.ë¥¼ ì°¾ëŠ” ë‘ë²ˆì§¸ ë°©ë²• (: closestë¡œ ì¡°ìƒ ì°¾ê¸°)
          // TODO í´ë¡œì € ë‹¨ì›ì—ì„œ ì´ìƒí•œ ë¶€ë¶„ í™•ì¸
          // deleteItem(item.no);
        });

        // ì‚­ì œ ì´ë²¤íŠ¸ ë“±ë¡ (ì‚­ì œë°©ë²•1)
        // deleteElem.setAttribute("onclick", `deleteItem(${item.no})`);

        // ì™„ë£Œ/ë¯¸ì™„ë£Œ ì²˜ë¦¬
        titleElem.addEventListener("click", function (event) {
          const btn = event.target;
          const liNode = btn.closest("li");
          toggleDone(liNode.dataset.no);
        });
        return liElem;
      }

      /**
       * ì¶”ê°€ ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰ë˜ëŠ” ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
       * ì…ë ¥ì°½ì˜ ê°’ì„ ê°€ì ¸ì™€ ìƒˆë¡œìš´ Todo ì•„ì´í…œì„ ì¶”ê°€
       */
      function handleAdd() {
        const inputElem = document.querySelector(".todoinput > input");

        if (inputElem.value.trim() !== "") {
          addItem(" " + inputElem.value);
          inputElem.value = ""; // ì¸í’‹ clear
          inputElem.focus(); // ë“±ë¡ í›„ì— í¬ì»¤ìŠ¤ ì…ë ¥ì°½ì— ê°€ë„ë¡ ì„¤ì •
        }
      }

      /**
       * ì…ë ¥ì°½ì—ì„œ í‚¤ë³´ë“œ ì…ë ¥ ì‹œ ì‹¤í–‰ë˜ëŠ” ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
       * Enter í‚¤ ì…ë ¥ ì‹œ ì¶”ê°€ ê¸°ëŠ¥ ì‹¤í–‰
       * @param {KeyboardEvent} event - í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ê°ì²´
       */
      function handleKeyup(event) {
        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆëŠ” Event ê°ì²´
        if (event.key === "Enter") {
          handleAdd();
        }
      }

      // í• ì¼ ì¶”ê°€
      /**
       * ìƒˆë¡œìš´ Todo ì•„ì´í…œì„ ëª©ë¡ì— ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜
       * @param {string} title - ì¶”ê°€í•  Todo ì•„ì´í…œì˜ ì œëª©
       */ function addItem(title) {
        const todoList = document.querySelector(".todolist");

        const item = {
          // children: ìì‹ë…¸ë“œì˜ ëª©ë¡(ìš”ì†Œë…¸ë“œ)
          no: todoList.children.length + 1,
          // no: document.querySelectorAll('.todolist > li').length + 1,
          // no: ++itemNo,
          // title: "test",
          title, // ì†ì„±ê°’ì„ ë‹´ëŠ” ë³€ìˆ˜ê°€ ì†ì„±ëª…ê³¼ ì¼ì¹˜í•  ê²½ìš° ì†ì„±ê°’ ìƒëµ ê°€ëŠ¥
          done: false, // ë¯¸ì™„ë£Œ ìƒíƒœ
        };

        const todoLi = getTodoItemElem(item);

        todoList.appendChild(todoLi);
      }

      /**
       * Todo ì•„ì´í…œì˜ ì™„ë£Œ/ë¯¸ì™„ë£Œ ìƒíƒœë¥¼ í† ê¸€í•˜ëŠ” í•¨ìˆ˜
       * @param {number} no - í† ê¸€í•  Todo ì•„ì´í…œì˜ ë²ˆí˜¸
       */
      function toggleDone(no) {
        const targetLi = document.querySelector(`.todolist > li[data-no="${no}"]`);
        const done = targetLi.dataset.done === "true";

        console.log(typeof done, done);

        const titleEl = targetLi.querySelector("span:last-of-type");
        if (done) {
          // doneì´ trueë¼ë©´ <span><s>ìƒ˜í”Œ3</s></span> -> <span>ìƒ˜í”Œ3</span>ë¡œ ìˆ˜ì •
          titleEl.appendChild(titleEl.firstChild.firstChild);
          titleEl.firstChild.remove();
          titleEl.setAttribute("style", `color:black;`); // ìƒ‰ë„ ë°”ê¿”ì¤Œ
        } else {
          // doneì´ false <span>ìƒ˜í”Œ3</span> -> <span><s>ìƒ˜í”Œ3</s></span>ë¡œ ìˆ˜ì •
          const sElem = document.createElement("s"); // <s> ìƒì„±
          sElem.appendChild(titleEl.firstChild); // <s>ìƒ˜í”Œ3</s> <span></span>
          titleEl.appendChild(sElem); // <span><s>ìƒ˜í”Œ3</s></span>
          titleEl.setAttribute("style", `color:gray;`); // ìƒ‰ë„ ë°”ê¿”ì¤Œ
        }
        targetLi.dataset.done = !done; // ì™„ë£Œì—¬ë¶€ ì†ì„± ë³€ê²½
      }

      /* síƒœê·¸ ìœ ë¬´ë¥¼ ì½ì–´ì„œ ì¡°ì •í•˜ëŠ” ë²„ì „ : ì†ì„±ì‚¬ìš© X */
      // function toggleDone(no) {
      //   const titleElem = document.querySelector(`.todolist > li[data-no="${no}"] > span:nth-child(2)`);
      //   const isDone = titleElem.querySelector("s") !== null;
      //   const text = titleElem.textContent;
      //   if (isDone) {
      //     titleElem.innerHTML = text;
      //   } else {
      //     titleElem.innerHTML = `<s>${text}</s>`;
      //   }
      // }

      /**
       * Todo ì•„ì´í…œì„ ì‚­ì œí•˜ëŠ” í•¨ìˆ˜
       * @param {number} no - ì‚­ì œí•  Todo ì•„ì´í…œì˜ ë²ˆí˜¸
       */
      function deleteItem(no) {
        const targetLi = document.querySelector(`.todolist > li[data-no="${no}"]`);
        targetLi.remove();
      }
    </script>
  </body>
</html>
